var sorter={sqr:function(e){return e*e},evCoords:function(e,r){return browser.android?[e.touches[0].pageX+(e.pageX||0),e.touches[0].pageY+(e.pageY||0)+(r.scrollNode&&r.scrollNode.scrollTop||0)]:[e.pageX,e.pageY+(r.scrollNode&&r.scrollNode.scrollTop||0)]},animstop:function(){clearInterval(sorter.animtimer),sorter.animtimer=!1},animcache:{},animstep:function(){var e=[],r=!0;for(var t in sorter.animcache)if(0!=t){var o=sorter.animcache[t],s=o.el,n=Fx.Transitions.easeOutQuint,l=vkNow();o.t+=l-o.prev,o.prev=l,o.t<200?(r=!1,s.style.left=n(o.t,o.sx,o.dx,200)+"px",s.style.top=n(o.t,o.sy,o.dy,200)+"px"):(s.style.left=o.sx+o.dx+"px",s.style.top=o.sy+o.dy+"px",clearInterval(o.timer),e.push(s.id),o.h&&o.h())}else r=!1,scrollNode.scrollTop+=Math.ceil(sorter.animcache[t]/5);for(var t in e)delete sorter.animcache[e[t]];r&&sorter.animstop()},animate:function(e,r,t,o){if(browser.msie8)return setStyle(e,{left:r,top:t}),void(o&&o());var s=intval(getStyle(e,"left")),n=intval(getStyle(e,"top")),l={t:0,sx:s,sy:n,dx:r-s,dy:t-n,h:o,prev:vkNow()};sorter.animcache[e.id]?extend(sorter.animcache[e.id],l):(sorter.animcache[e.id]=extend(l,{el:e}),sorter.animtimer||(sorter.animtimer=setInterval(sorter.animstep,13)))},mousedown:function(e){var r=e&&e.touches&&1==e.touches.length;if(e&&(2==e.button||3==e.which||e.ctrlKey||e.metaKey)&&!r)return!0;if(!sorter.current){var t=this,o=t.parentNode.sorter,s=sorter.evCoords(e,o);if(!("A"==e.target.tagName||"INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName||e.target.getAttribute("nosorthandle")||e.target.parentNode&&"A"==e.target.parentNode.tagName))return(sorter.current=o).drag=t,addEvent(document,"mousemove drag touchmove",sorter.mousemove),addEvent(document,"mouseup touchend touchcancel",sorter.mouseup),browser.opera||browser.msie||browser.mozilla||browser.safari_mobile||browser.android||o.noscroll||(addEvent(sorter.scrollNode,"scroll",sorter.mousemove),o.scrollNode&&o.scrollNode.scrollHeight>o.scrollNode.offsetHeight&&addEvent(o.scrollNode,"scroll",sorter.mousemove)),extend(o,{startX:s[0],startY:s[1]+(browser.msie6?pageNode.scrollTop+(o.scrollNode&&o.scrollNode.scrollTop||0):0),before:!!t.nextSibling&&t.nextSibling.nextSibling,after:t.helper.previousSibling,startIndex:t.index}),extend(sorter,{lastX:s[0],lastY:s[1],lastS:scrollNode.scrollTop+(o.scrollNode&&o.scrollNode.scrollTop||0)}),setStyle(t,{zIndex:13}),addClass(t,"sort_taken"),window.Privacy&&Privacy.hide(-1),o.onMouseDown&&o.onMouseDown(t),cur.cancelClick=!1,r||cancelEvent(e)}},mousemove:function(e){if(sorter.current){var r=sorter.current,t=!0,o="scroll"==e.type?[sorter.lastX,sorter.lastY+scrollNode.scrollTop+(r.scrollNode&&r.scrollNode.scrollTop||0)-sorter.lastS]:sorter.evCoords(e,r);if("scroll"==e.type)t=!1;else{sorter.lastX=o[0],sorter.lastY=o[1],sorter.lastS=scrollNode.scrollTop+(r.scrollNode&&r.scrollNode.scrollTop||0);var s=o[1]-(browser.msie6?0:scrollNode.scrollTop+(r.scrollNode&&r.scrollNode.scrollTop||0));browser.safari_mobile||browser.android||r.noscroll||(s<100?sorter.animcache[0]=s-100:s>lastWindowHeight-100?sorter.animcache[0]=100+s-lastWindowHeight:sorter.animcache[0]&&delete sorter.animcache[0],sorter.animcache[0]&&!sorter.animtimer&&(sorter.animtimer=setInterval(sorter.animstep,13)))}var n,l=r.drag,a=o[0]-r.startX,i=o[1]+(browser.msie6?pageNode.scrollTop:0)-r.startY,d=(y=l.helper.offsetLeft)+a,c=(N=l.helper.offsetTop)+i;if((10<a||a<-10||10<i||i<-10)&&(cur.cancelClick=!0),r._dragtargets)for(var p in r._dragtargets.nodes){var f=r._dragtargets.nodes[p],m=getXY(f),h=getSize(f),u=o[0]-m[0],g=o[1]-m[1];0<u&&u<h[0]&&0<g&&g<h[1]?f._dragover||(r._dragtargets.onDragOver&&r._dragtargets.onDragOver(l,f),f._dragover=!0,r._dragtarget=f):f._dragover&&(r._dragtargets.onDragOut&&r._dragtargets.onDragOut(l,f),f._dragover=!1,r._dragtarget=null)}if(setStyle(l,{left:d,top:c}),browser.msie8)l.offsetLeft;if(d+l.w/2>y&&c+l.h/2>N&&d-l.w/2<y&&c-l.h/2<N)return!t||cancelEvent(e);p=0;for(var v=0,x=1e9;p<r.elems.length;++p){var w=r.elems[p],b=sorter.sqr(w.x-d)+sorter.sqr(w.y-c);b<x&&(v=p,x=b)}if(v==l.index)return!t||cancelEvent(e);v<l.index?(r.parent.insertBefore(l,r.elems[v].helper),n=-1):v>l.index&&(r.elems[v].nextSibling?r.parent.insertBefore(l,r.elems[v].nextSibling):r.parent.appendChild(l),n=1),r.parent.insertBefore(l.helper,l),(v==r.elems.length-1?addClass:removeClass)(l.helper,"sort_helper_last");for(p=l.index;p!=v;p+=n){var y=(w=r.elems[p]=r.elems[p+n]).helper.offsetLeft,N=w.helper.offsetTop;extend(w,{index:w.index-n,x:y+w.w/2,y:N+w.h/2}),sorter.animate(w,y,N)}return r.elems[v]=l,extend(l,{index:v,x:l.helper.offsetLeft+l.w/2,y:l.helper.offsetTop+l.h/2}),r.startX=o[0]-d+l.helper.offsetLeft,r.startY=o[1]+(browser.msie6?pageNode.scrollTop:0)-c+l.helper.offsetTop,!t||cancelEvent(e)}},mouseup:function(e){if(sorter.current){var r=sorter.current,t=r.drag;if(setStyle(t,{zIndex:12}),sorter.animate(t,t.previousSibling.offsetLeft,t.previousSibling.offsetTop,function(){setStyle(t,{zIndex:""}),removeClass(t,"sort_taken")}),sorter.stop(),sorter.animcache[0]&&(delete sorter.animcache[0],isEmpty(sorter.animcache)&&sorter.animstop()),r.onMouseUp){var o=r._dragtarget;if(o&&(r._dragtargets.onDragOut&&r._dragtargets.onDragOut(t,o),sorter.restore(r,t)),r.onMouseUp(t,o),delete r._dragtarget,o)return cancelEvent(e)}var s=!!t.nextSibling&&t.nextSibling.nextSibling,n=t.helper.previousSibling;return s==r.before&&n==r.after||!r.onReorder||r.onReorder(t,s,n),delete r.startIndex,delete r.before,delete r.after,cancelEvent(e)}},stop:function(){var e=sorter.current;removeEvent(document,"mousemove drag touchmove",sorter.mousemove),removeEvent(document,"mouseup touchend touchcancel",sorter.mouseup),e.drag=sorter.current=!1},restore:function(e,r){var t,o=e.startIndex;o<r.index?(e.parent.insertBefore(r,e.elems[o].helper),t=-1):o>r.index&&(e.elems[o].nextSibling?e.parent.insertBefore(r,e.elems[o].nextSibling):e.parent.appendChild(r),t=1),e.parent.insertBefore(r.helper,r);for(var s=r.index;s!=o;s+=t){var n=e.elems[s]=e.elems[s+t],l=n.helper.offsetLeft,a=n.helper.offsetTop;extend(n,{index:n.index-t,x:l+n.w/2,y:a+n.h/2}),sorter.animate(n,l,a)}e.elems[o]=r,extend(r,{index:o,x:r.helper.offsetLeft+r.w/2,y:r.helper.offsetTop+r.h/2}),sorter.animate(r,r.helper.offsetLeft,r.helper.offsetTop),delete e.startIndex,delete e.before,delete e.after},shift:function(e){var r=e.sorter,t=r.elems[r.elems.length-1];r.parent.insertBefore(t,r.elems[0].helper),r.parent.insertBefore(t.helper,t);for(var o=t.index;0!=o;o+=-1){var s=r.elems[o]=r.elems[o+-1],n=s.helper.offsetLeft,l=s.helper.offsetTop;extend(s,{index:s.index- -1,x:n+s.w/2,y:l+s.h/2}),s.style.left=n+"px",s.style.top=l+"px"}n=t.helper.offsetLeft,l=t.helper.offsetTop;r.elems[0]=t,extend(t,{index:0,x:n+t.w/2,y:l+t.h/2}),t.style.left=n+"px",t.style.top=l+"px"},added:function(e){for(var r=e.sorter,t=r.elems.length,o=t?e.sorter.elems[t-1].nextSibling:e.firstChild,s=t;o&&!o.getAttribute("stopsort");o=o.nextSibling,++s)if(!o.getAttribute("skipsort")){r.elems.push(o);var n=o.offsetLeft,l=o.offsetTop,a=getSize(o),i={width:a[0],height:a[1]-r.dh};extend(o,{helper:ce("div",{className:"sort_helper"},i),x:n+a[0]/2,w:a[0],y:l+a[1]/2,h:a[1],index:s});var d={left:n,top:l,width:getStyle(o,"width"),position:"absolute"};r.noMoveCursor||(d.cursor="move"),setStyle(o,d),e.insertBefore(o.helper,o),addEvent(o,"mousedown touchstart",sorter.mousedown)}},update:function(e){if(e){var r=e.parentNode.sorter,t=!1;for(var o in r.elems){var s=r.elems[o];if(s==e&&(t=!0),t){var n=s.helper.offsetLeft,l=s.helper.offsetTop,a=getSize(s);setStyle(s.helper,{height:a[1]-r.dh}),extend(s,{x:n+a[0]/2,w:a[0],y:l+a[1]/2,h:a[1]});var i={left:n,top:l,position:"absolute"};r.noMoveCursor||(i.cursor="move"),setStyle(s,i)}}}},init:function(e,r){if(!browser.mobile||browser.safari_mobile||browser.android){sorter.scrollNode=browser.msie6?pageNode:window;var o={parent:e=ge(e),dh:r.dh||0,scrollNode:r.scrollNode,noMoveCursor:r.noMoveCursor||0,elems:[],stop:function(){for(var e in sorter.current==o&&sorter.stop(),o.elems){var r=o.elems[e];sorter.animcache[r.id]&&delete sorter.animcache[r.id]}},destroy:function(){o.stop();var e=o.parent;for(var r in removeAttr(e,"sorter"),o.elems){var t=o.elems[r];e.removeChild(t.helper),removeEvent(t,"mousedown touchstart",sorter.mousedown),setStyle(t,{position:"",margin:""}),removeAttr(t,"helper")}sorter.animstop()},onReorder:r.onReorder,noscroll:r.noscroll};r.onMouseDown&&(o.onMouseDown=r.onMouseDown),r.onMouseUp&&(o.onMouseUp=r.onMouseUp);var t={nodes:[]};if(r&&r.target){var s=r.target.childNodes;each(s,function(e,r){1==r.nodeType&&t.nodes.push(r)}),t.onDragOver=r.onDragOver,t.onDragOut=r.onDragOut,0<t.nodes.length&&(o._dragtargets=t)}return e.sorter=o,sorter.added(e),o}}};try{stManager.done("sorter.js")}catch(e){}