!function(e){function o(o){for(var t,l,i=o[0],d=o[1],s=o[2],c=0,p=[];c<i.length;c++)l=i[c],r[l]&&p.push(r[l][0]),r[l]=0;for(t in d)Object.prototype.hasOwnProperty.call(d,t)&&(e[t]=d[t]);for(n&&n(o);p.length;)p.shift()();return a.push.apply(a,s||[]),_()}function _(){for(var e,o=0;o<a.length;o++){for(var _=a[o],t=!0,i=1;i<_.length;i++){var d=_[i];0!==r[d]&&(t=!1)}t&&(a.splice(o--,1),e=l(l.s=_[0]))}return e}var t={},r={"web/photos_add":0},a=[];function l(o){if(t[o])return t[o].exports;var _=t[o]={i:o,l:!1,exports:{}};return e[o].call(_.exports,_,_.exports,l),_.l=!0,_.exports}l.m=e,l.c=t,l.d=function(e,o,_){l.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:_})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,o){if(1&o&&(e=l(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var _=Object.create(null);if(l.r(_),Object.defineProperty(_,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var t in e)l.d(_,t,function(o){return e[o]}.bind(null,t));return _},l.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(o,"a",o),o},l.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},l.p="/js/cmodules/";var i=window.webpackJsonp=window.webpackJsonp||[],d=i.push.bind(i);i.push=o,i=i.slice();for(var s=0;s<i.length;s++)o(i[s]);var n=d;a.push([206,"bundles/common"]),_()}({206:function(e,o,_){e.exports=_("Gp6y")},Gp6y:function(e,o,_){"use strict";_.r(o);var t=_("hNUV");window.PhotosAdd=t.PhotosAdd;try{stManager.done(jsc("web/photos_add.js"))}catch(e){}},hNUV:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"PhotosAdd",function(){return PhotosAdd});var core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("rGqo"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("pIFo"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("t7n3"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("zxIV"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("lXE5"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("aong"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("4+be"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("98sY"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("EasH"),PhotosAdd={PROGRESS_OPACITY_SPEED:100,checkChanges(e){if(!cur.leaving){if(cur.album&&cur.uploadStarted){var o=getLang("photos_uploading_warning");if(1===e){var _=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_11__.showFastBox)({title:getLang("global_warning"),dark:1},o,getLang("photos_stop_uploading"),()=>{cur.leaving=!0,_.hide(),cur.onContinueCb&&cur.onContinueCb()},getLang("global_cancel"));return!0}return winToUtf(o)}return!e&&void 0}},go:(e,o)=>PhotosAdd.checkChanges(1)?(cur.onContinueCb=nav.go.pbind(e,o),!0):nav.go(e,o),initBeforeUnload(){cur.unloadInited||(cur.unloadInited=!0,cur.nav.push((e,o,_)=>PhotosAdd.checkChanges(1)?(cur.onContinueCb=nav.go.pbind(_),!1):cur.album==vk.id+"_-7"&&cur.savedPhotos&&cur.savedPhotos.length&&!cur.savingPhotos?(cur.savingPhotos=!0,ajax.post("/al_photos.php",{act:"publish_photos",hash:cur.post_hash,photos:cur.savedPhotos.join(",")},{onDone:nav.go.pbind(_)}),!1):void 0),addEvent(window,"mousewheel",PhotosAdd.wheelHandler),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=PhotosAdd.checkChanges,cur.destroy.push(()=>{window.onbeforeunload=cur.prevBefUnload,removeEvent(window,"mousewheel",PhotosAdd.wheelHandler)}))},genFile:(e,o,_)=>ce("div",{innerHTML:`\n      <a class="photo_file_cancel" id="photo_cancel${e}" onclick="${o}">${_}</a>\n      <div class="photo_file_button">\n        <div class="file_button_gray">\n          <div class="file_button" id="photo_file_button${e}">${getLang("photos_choose_file")}</div>\n        </div>\n      </div>\n      `}),initFile(e){FileButton.init(`photo_file_button${e}`,{name:"photo",id:`photo_file${e}`,accept:"image/jpeg,image/png,image/gif",onchange:PhotosAdd.fileSelected})},addFile(){var e=cur.files.length,o=PhotosAdd.genFile(e,`PhotosAdd.fileCancel(${e})`,getLang("global_cancel"));extend(o,{className:"photo_upload_file",id:`photo_upload_row${e}`}),ge("photo_upload_files").appendChild(o),PhotosAdd.initFile(e),cur.files.push({})},fileSelected(){var e=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(this.id.replace("photo_file",""));if(cur.files[e].deleting||!cur.files[e].cont&&!cur.files[e].id){cur[`fileDone${e}`]=PhotosAdd.fileDone.pbind(e),cur[`fileFail${e}`]=PhotosAdd.fileFail.pbind(e),cur.files[e].cont=utilsNode.appendChild(ce("div",{innerHTML:`\n        <iframe name="photo_frame${e}"></iframe>\n        <form target="photo_frame${e}" id="photo_form${e}" method="POST" action="${cur.url}" enctype="multipart/form-data"></form>\n      `}));var o=ge(`photo_form${e}`),_=extend(cur.fields,{act:"do_add",al:1,from_host:locHost,ondone:`cur.fileDone${e}`,onfail:`cur.fileFail${e}`});for(var t in _)_.hasOwnProperty(t)&&o.appendChild(ce("input",{name:t,value:_[t]}));o.appendChild(this),o.submit();var r=ge(`photo_file_button${e}`);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_10__.lockButton)(r),setTimeout(()=>{r.innerHTML=r.innerHTML},0),show(`photo_cancel${e}`),ge(`photo_cancel${e}`).innerHTML=getLang("global_cancel"),e==cur.files.length-1&&PhotosAdd.addFile()}},fileDone(i,res){hide(`photo_cancel${i}`);for(var before="",j=i+1,obj;j<cur.files.length;++j)if(cur.files[j].id&&!cur.files[j].deleting){before=cur.files[j].id;break}try{obj=eval("("+res+")")}catch(e){obj=AjaxConvert.fromQueryString(res),Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,res)}PhotosAdd.fetchGeo(obj),setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",before,context:1,geo:1},obj),{onDone(e,o){if(!e)return PhotosAdd.fileFail(i,0);cur.files[i].cont.innerHTML="",utilsNode.removeChild(cur.files[i].cont),extend(cur.files[i],{id:e,deleting:!1,cont:!1}),ge(`photo_upload_row${i}`).innerHTML=o,autosizeSetup(`photo_caption${e}`,{minHeight:30}),show(`photo_delete${e}`),window._tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(_tbLink.loc))},onFail(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_11__.showFastBox)({title:getLang("global_error"),dark:1},e).hide,3e3),PhotosAdd.fileCancel(i),!0}}),0)},fileCancel(e,o){if(cur.files[e].cont&&(cur.files[e].cont.innerHTML="",utilsNode.removeChild(cur.files[e].cont)),!o){var _=ge(`photo_file_button${e}`);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_10__.unlockButton)(_),_.innerHTML=getLang("photos_choose_file"),cur.files[e]={},PhotosAdd.initFile(e),hide(`photo_cancel${e}`)}},fileFail(e,o){PhotosAdd.fileCancel(e)},fileDelete(e,o){for(var _=0;_<cur.files.length&&cur.files[_].id!=e;)++_;if(_!=cur.files.length&&!cur.files[_].deleting){cur.files[_].deleting=!0,ajax.post("al_photos.php",{act:"delete_photo",photo:e,hash:o,edit:2},{onFail(){cur.files[_].deleting=!1}});var t=ge(`photo_edit_row${e}`);t.parentNode.insertBefore(PhotosAdd.genFile(_,`PhotosAdd.fileRestore('${e}', '${o}')`,getLang("global_restore")),t),hide(t),PhotosAdd.initFile(_),show(`photo_cancel${_}`)}},fileRestore(e,o){for(var _=0,t="";_<cur.files.length&&cur.files[_].id!=e;)++_;if(_!=cur.files.length&&cur.files[_].deleting&&-1!==cur.files[_].deleting){if(cur.files[_].cont)return PhotosAdd.fileCancel(_);for(var r=_+1;r<cur.files.length;++r)if(cur.files[r].id&&!cur.files[r].deleting){t=cur.files[r].id;break}cur.files[_].deleting=-1,ajax.post("al_photos.php",{act:"restore_photo",photo:e,hash:o,before:t,edit:2},{onDone(){cur.files[_].deleting=!1}});var a=ge(`photo_edit_row${e}`);show(a),re(a.previousSibling)}},filesDone(e){var o=AjaxConvert.fromQueryString(e);PhotosAdd.fetchGeo(o),setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",context:2,geo:1},o)),0)},filesFail(){for(var e=0;e<cur.files.length;++e)PhotosAdd.fileCancel(e);cur.allcont.innerHTML="",utilsNode.removeChild(cur.allcont),cur.allcont=!1},backupDesc(e){cur.descs||(cur.descs={}),cur.descs[e]=trim(ge(`photo_caption${e}`).value)},saveDesc(e,o){var _=ge(`photo_caption${e}`).value,t=(cur.descs||{})[e];delete(cur.descs||{})[e],trim(_)!=t&&ajax.post("al_photos.php",{act:"save_desc",photo:e,hash:o,text:_,edit:1},{onDone(o){ge(`photo_save_result${e}`).innerHTML=o},onFail:o=>(ge(`photo_save_result${e}`).innerHTML=`<div class="photo_save_error">${o}</div>`,!0),showProgress:function(){ge(`photo_save_result${e}`).innerHTML=getLang("photos_privacy_description"),show(`photo_save_progress${e}`)},hideProgress:function(){hide(`photo_save_progress${e}`)}})},activeTab(e){for(var o=domPN(domPN(e)),_=domFC(o);_;_=domNS(_))removeClass(_,"active_link");addClass(domPN(e),"active_link"),domFC(ge("photo_add_tab"))!==e&&re("photo_add_tab")},wheelHandler(){cur.album&&(cur.scrollFixed=scrollNode.scrollTop+window.innerHeight!=scrollNode.offsetHeight)},setThumb(e,o){var _=geByClass1("photos_add_img",e),t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(_);o.mtop=0,browser.opera&&(o.mtop=o.mtop-2),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(o,{width:t[0],marginLeft:Math.floor((132-t[0])/2)})},thumbOver(e,o){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.geByClass)("photos_add_controls",e)[0];_||(_=ce("div",{id:`photos_add_controls${o}`,className:"photos_add_controls",innerHTML:`\n          <div class="photos_add_c_bar">\n            <a class="photos_add_rl" onclick="PhotosAdd.rotateAngle('${o}', 90);"></a>\n            <a class="photos_add_rr" onclick="PhotosAdd.rotateAngle('${o}', -90);"></a>\n          </div>\n        `}),e.appendChild(_)),PhotosAdd.setThumb(e,_),show(_),animate(_,{height:24,marginTop:_.mtop-24},{duration:200,transition:Fx.Transitions.easeOutCirc})},thumbOut(e){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.geByClass)("photos_add_controls",e)[0];o&&animate(o,{height:0,marginTop:o.mtop},200)},rotateAngle(e,o,_,t){var r=gpeByClass("photos_photo_edit_row",_);e=attr(r,"data-id"),window.tooltips&&tooltips.hideAll(),cancelEvent(t);var a=cur.photoData[e],l=ge("photo_rotate_form"+e);l.innerHTML="",l.action=a.rotate[0];var i=extend({act:"do_rotate",to:90==o?1:-1,fid:e},a.rotate);if("rotate_photo"==i.act&&(i.angle=(i.angle+i.to+4)%4),i[`rot${(i.to+4)%4}`])return i.act="done_rotate",i.complete=1,ajax.post("/al_photos.php",i,{onDone:PhotosAdd.rotateDone,onFail:PhotosAdd.rotateDone}),!1;for(var d in i)i.hasOwnProperty(d)&&0!=d&&l.appendChild(ce("input",{type:"hidden",name:d,value:i[d]}));return l.submit(),window.ajaxCache={},delete cur.pvList,delete cur.pvData,!1},rotateDone(e){if(e){var o=e.photo_raw,_=ge(`photo_edit_row_${o}`),t=geByClass1("photos_photo_edit_row_thumb",_);window.photos._hideProgressPanel(_),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(t,{"background-image":`url('${e.p_src||e.q_src}')`}),delete e.m_,delete e.o_;var r=cur.photoData[o];extend(r.rotate,{photo:e.photo,hash:e.hash,rhash:e.rhash,angle:e.angle,rot1:e.rot1,rot3:e.rot3}),window.ajaxCache={},delete cur.pvList,delete cur.pvData}},scrollToBottom(e){if(!cur.scrollFixed){var o=window,_=document.documentElement;if(e||(e=cur.lastPhotoRow),o.pageNode&&e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(e),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(e),a=Math.max(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(o.innerHeight),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(_.clientHeight));t[1]<=0&&(t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(e.parentNode));var l=t[1]+r[1]-a+200;l>0&&l>scrollNode.scrollTop&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToY)(l,400)}}},_onScroll(){if(null!==cur.pageBlockHeader&&(cur.pageBlockHeader=cur.pageBlockHeader||geByClass1("page_block_header",ge("photos_add_block")),cur.pageBlockHeader)){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(ge("page_header_cont"))[1];cur.photoAddHeaderElOffset=cur.photoAddHeaderElOffset||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(cur.pageBlockHeader)[1]-e;var o=ge("photos_add_block");Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollGetY)()>=cur.photoAddHeaderElOffset?(addClass(cur.pageBlockHeader,"photos_header_fixed"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.pageBlockHeader,{width:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(ge("page_body"))[0],top:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)("page_header")[1]}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(o,{"padding-top":`${Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(cur.pageBlockHeader)[1]}px`})):(removeClass(cur.pageBlockHeader,"photos_header_fixed"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.pageBlockHeader,{width:""}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(o,{"padding-top":""})),PhotosAdd.updateBottomFixedPanel()}},updateBottomFixedPanel(){if(null!==cur.fixedBottomPanel&&(cur.fixedBottomPanel=cur.fixedBottomPanel||ge("photos_go_to_album"),cur.fixedBottomPanel)){var e=ge("photos_add_block");if(e){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(e)[1],_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(e)[1];Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.clientHeight)()+Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollGetY)()<o+_?(addClass(cur.fixedBottomPanel,"photos_bottom_fixed"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.fixedBottomPanel,{width:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(ge("page_body"))[0]}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domPS)(cur.fixedBottomPanel),{"padding-bottom":`${10+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(cur.fixedBottomPanel)[1]}px`})):(removeClass(cur.fixedBottomPanel,"photos_bottom_fixed"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.fixedBottomPanel,{width:""}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domPS)(cur.fixedBottomPanel),{"padding-bottom":""}))}}},initFixedHeader(){var e=()=>{removeEvent(window,"scroll",PhotosAdd._onScroll)};e(),addEvent(window,"scroll",PhotosAdd._onScroll),cur.destroy.push(e)},onUploadStart(e,o){if(PhotosAdd.initBeforeUnload(),cur.onPhotoAddStart&&cur.onPhotoAddStart(),cur.flash_lite&&void 0===e.num&&(e=o),0==e.num&&(cur.errorCount=0,!ge("photos_add_wrap"))){cur.count=0,show("photos_add_block"),removeClass(ge("photos_add_block"),"unshown"),hide("photos_tagged_block"),hide("photos_all_block");var _=ge("photos_albums_block");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(_,{visibility:"hidden",height:0,padding:0,margin:0,overflow:"hidden"}),each(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.geByClass)("photos_period_delimiter_fixed"),hide),cur.prevDocTitle=document.title,cur.uploadStarted=!0,hide("photos_go_to_album"),PhotosAdd.initFixedHeader()}cur.photosAddFirst||(cur.photosAddFirst=!0),e.prepareCont=se(rs(cur.uploadRowTpl,{photo_raw:"",thumb:"",description:"",hash:""})),re(geByClass1("photos_photo_edit_row_selector",e.prepareCont)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(e.prepareCont,{display:"none"}),window.photos._showProgressPanel(e.prepareCont),cur.flash_lite&&(cur.flashPrepareCont=cur.flashPrepareCont||{},cur.flashPrepareCont[e.num]=cur.flashPrepareCont[e.num]||{},cur.flashPrepareCont[e.num][e.filename]=e.prepareCont),ge("photos_add_list").appendChild(e.prepareCont),cur.lastPhotoRow=e.prepareCont,PhotosAdd.makeTask(()=>(show(e.prepareCont),show(geByClass1("photos_photo_edit_row_progress",e.prepareCont)),PhotosAdd.scrollToBottom(),!0)),cur.uplSelected=!0,ajax.post("al_photos.php",{act:"start_add",hash:cur.statsPhotoAddHash})},updateProgressBar(e,o,_){var t=ge("photos_uploaded_progress"),r=ge("photos_total_progress");if(!1===e){var a=ge("photos_upload_btn");addClass(t,"photos_progress_hidden"),setTimeout(()=>{hide(t),show(a),setTimeout(removeClass.pbind(a,"photos_progress_hidden"))},PhotosAdd.PROGRESS_OPACITY_SPEED),e=1}else if(hasClass(t,"photos_progress_hidden")){var l=ge("photos_upload_btn");addClass(l,"photos_progress_hidden"),setTimeout(()=>{hide(l),show(t),setTimeout(removeClass.pbind(t,"photos_progress_hidden"))},PhotosAdd.PROGRESS_OPACITY_SPEED),e=0}var i=geByClass1("ui_progress_bar",r);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(i,"width",e*Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(r)[0]),o||_){o=o||0,_=_||0;var d=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.langNumeric)(o,cur.uploaderLang.photos_upload_progress).replace("{count}",o).replace("{total}",_);val(ge("photos_total_progress_text"),d)}},hideUploadProgress(){PhotosAdd.updateProgressBar(!1)},onUploadProgress(e,o,_){var t=e.totalCount||1,r=e.num||0,a=1/t,l=r*a;PhotosAdd.updateProgressBar(l+a*o/_,r,t)},onUploadComplete(info,res){var obj;cur.flash_lite&&(info.prepareCont=cur.flashPrepareCont[info.num][info.filename]);try{obj=eval("("+res+")")}catch(e){obj=AjaxConvert.fromQueryString(res),Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,res)}if(!obj.photos)return cur.errorCount++,re(info.prepareCont),info.prepareCont&&info.prepareCont.helper&&re(info.prepareCont.helper),ge("photos_upload_error_msg").innerHTML=cur.uploaderLang.photos_add_error,show("photos_upload_error"),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToTop)(200),void PhotosAdd.makeTask();if(obj.code)Upload.onUploadError(cur.UplId,obj.code);else{PhotosAdd.fetchGeo(obj);var params=extend({act:"done_add",from:"html5",context:1,geo:1},obj);cur.lastPhotoRow=info.prepareCont,cur.photoSaveQ=cur.photoSaveQ||[],cur.photoSaveQ.push(()=>{ajax.post("al_photos.php",params,{onDone(html,js,photoRaw,thumb,editHash,qParams){hide("photos_upload_error"),cur.count++,info.prepareCont=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domReplaceEl)(info.prepareCont,html),re(geByClass1("photos_photo_edit_row_selector",info.prepareCont));try{eval(js)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,js)}cur.savedPhotos=cur.savedPhotos||[],cur.savedPhotos.push(photoRaw),cur.savedThumbs=cur.savedThumbs||{},cur.savedThumbs[photoRaw]=thumb;var thumbEl=geByClass1("photos_photo_edit_row_thumb",info.prepareCont),thumbImage=vkImage();thumbImage.onload=()=>{removeClass(thumbEl,"no_thumb"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(thumbEl,"background-image",`url('${thumb}')`),hide(geByClass1("photos_photo_edit_row_progress",info.prepareCont))},thumbImage.src=thumb,PhotosAdd.makeTask(),cur.photoSaveQ.shift(),cur.photoSaveQ[0]&&cur.photoSaveQ[0](),cur.onPhotoFirstUploaded&&cur.onPhotoFirstUploaded();var uploadDocumentTitle=cur.uploaderLang.photos_upload_progress_title.replace("{count}",cur.count).replace("{total}",info.totalCount);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setDocumentTitle)(replaceEntities(uploadDocumentTitle)),qParams&&PhotosAdd.queueCheckUpdates(qParams)},onFail(e){if(e&&(ge("photos_upload_error_msg").innerHTML=e,show("photos_upload_error"),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToTop)(200)),cur.errorUpload=!0,hasClass(info.prepareCont,"photos_add_first_child")){for(var o=info.prepareCont.nextSibling;o;){if(hasClass(o,"photos_add_upl_row")){addClass(o,"photos_add_first_child");break}o=o.nextSibling}o||(cur.photosAddFirst=!1)}return re(info.prepareCont),cur.photoSaveQ.shift(),cur.photoSaveQ[0]&&cur.photoSaveQ[0](),PhotosAdd.makeTask(),!0}})}),1==cur.photoSaveQ.length&&cur.photoSaveQ[0]()}},queueCheckUpdates(e){window.Notifier&&Notifier.addKey(e,PhotosAdd.queueReceiveUpdates)},queueReceiveUpdates(e,o){o.events&&o.events.forEach(e=>{var o=e.split("<!>"),_=o[1],t=o[2],r=JSON.parse(t);r&&Object.keys(r).length&&addClass(ge("photo_edit_row_"+_),"has_faces animated")})},onUploadCompleteAll(e,o){cur.uploadStartProgress=0,delete cur.uploadStarted,window.onbeforeunload=cur.prevBefUnload,delete cur.unloadInited,PhotosAdd.hideUploadProgress(),PhotosAdd.makeTask(()=>{if(cur.flash_lite){re("lite_photo_uploader");var e=ge("photos_upload_area"),o=ce("div",{innerHTML:'<div id="lite_photo_uploader" style="position: absolute; height: 100%; width: 100%; z-index: 9999; cursor: pointer;"></div>'}).firstChild;e.parentNode.insertBefore(o,e),cur.initFlashLite()}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setDocumentTitle)(cur.prevDocTitle),show("photos_go_to_album"),cur.lastPhotoRow=ge("photos_go_to_album"),PhotosAdd.updateBottomFixedPanel(),re("photos_albums_block")})},makeTask(e){if(cur.photoAddQ=cur.photoAddQ||[],e?cur.photoAddQ.push(e):cur.photoAddSt=!1,!cur.photoAddSt){var o=cur.photoAddQ.shift();o&&(cur.photoAddSt=o())}},fetchGeo(e){if(!e.photos)return!1;var o=Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_7__.parseJSON)(e.photos);if(!o)return!1;var _={},t=0;for(var r in o)if(o.hasOwnProperty(r)){var a=o[r].latitude,l=o[r].longitude;a&&l&&(_[a+","+l]=1,t+=1)}if(!t)return!1;stManager.add(["maps.js"],()=>{cur.placeMap=new window.vkMaps.VKMap(!1,"google"),cur.placeMap.isLoaded("google")?PhotosAdd.setGeo(_):cur.placeMap.load.addHandler(PhotosAdd.setGeo.pbind(_))})},setGeo(e){var o=cur.uploaderLang.geolang||"en",_=function(_){if(e.hasOwnProperty(_)){var r=(_=_.split(","))[0],a=_[1];new window.vkMaps.Geocoder("google",e=>{ajax.post("al_photos.php",{act:"a_set_geo",lat:_[0],long:_[1],geo_country:e.country,geo_locality:e.locality,geo_region:e.region,geo_street:e.street,geo_place:e.place,geo_lang:o,geo_code:e.countryCode})}).geocode({location:new window.google.maps.LatLng(r,a),language:o})}t=_};for(var t in e)_(t)}}}});